<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitPulse Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        oled: { black: '#000000', dark: '#0a0a0a', card: '#161616', teal: '#00F0FF', accent: '#FF0055', text: '#FFFFFF', muted: '#777777' }
                    },
                    fontFamily: { sans: ['Roboto', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #000000; color: white; overflow: hidden; }
        .light-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 30; transition: opacity 0.3s ease; opacity: 0; }
        .light-left { background: radial-gradient(ellipse 50% 70% at 0% 50%, rgba(0, 240, 255, 0.20) 0%, rgba(0, 240, 255, 0.02) 50%, transparent 70%); opacity: 1; }
        .light-right { background: radial-gradient(ellipse 50% 70% at 100% 50%, rgba(0, 240, 255, 0.20) 0%, rgba(0, 240, 255, 0.02) 50%, transparent 70%); opacity: 1; }
        ::-webkit-scrollbar { width: 0px; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #00F0FF; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px rgba(0,240,255,0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #333; border-radius: 2px; }
        
        /* Neon Play Button Animation - Teal Color & Increased Glow */
        .neon-play {
            /* Updated color to #00F0FF and increased blur radii for more glow */
            filter: drop-shadow(0 0 4px #00F0FF) drop-shadow(0 0 12px rgba(0, 240, 255, 0.7));
            transition: all 0.3s ease;
        }
        .neon-play:hover {
            /* Increased hover glow intensity */
            filter: drop-shadow(0 0 6px #00F0FF) drop-shadow(0 0 25px rgba(0, 240, 255, 1));
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { AreaChart, Area, ResponsiveContainer } = window.Recharts;

    const Icons = {
        // Updated stroke color to #00F0FF
        NeonPlay: () => (
            <svg viewBox="0 0 100 100" className="w-16 h-16 neon-play" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M35 25 L75 50 L35 75 Z" stroke="#00F0FF" strokeWidth="3.5" strokeLinejoin="round" />
            </svg>
        ),
        Pause: () => <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>,
        Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
        Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
        ChevronDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>,
        Info: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
    };

    const AudioEngine = () => {
        const audioCtxRef = useRef(null);
        const nextNoteTimeRef = useRef(0);
        const timerIDRef = useRef(null);
        const currentBeatRef = useRef(0); 
        const scheduleAheadTime = 0.1; 
        const lookahead = 25.0;
        const init = () => { const AudioContext = window.AudioContext || window.webkitAudioContext; audioCtxRef.current = new AudioContext(); };
        const playClick = (time, beatNumber) => {
            if (!audioCtxRef.current) return;
            const isLeft = beatNumber === 0;
            const bufferSize = audioCtxRef.current.sampleRate * 0.05; 
            const buffer = audioCtxRef.current.createBuffer(1, bufferSize, audioCtxRef.current.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = audioCtxRef.current.createBufferSource();
            noise.buffer = buffer;
            const filter = audioCtxRef.current.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = isLeft ? 800 : 1200; 
            filter.Q.value = 5; 
            const gain = audioCtxRef.current.createGain();
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtxRef.current.destination);
            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(1, time + 0.005);
            gain.gain.exponentialRampToValueAtTime(0.001, time + 0.05);
            noise.start(time);
        };
        const getCurrentTime = () => audioCtxRef.current ? audioCtxRef.current.currentTime : 0;
        const resume = () => { if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') audioCtxRef.current.resume(); };
        return { init, playClick, getCurrentTime, resume, nextNoteTimeRef, timerIDRef, scheduleAheadTime, lookahead, currentBeatRef };
    };

    const FitPulseApp = () => {
        const engine = useRef(AudioEngine());
        const [isPlaying, setIsPlaying] = useState(false);
        const [mode, setMode] = useState('static'); 
        const [beatIndex, setBeatIndex] = useState(0); 
        const [currentBPM, setCurrentBPM] = useState(120);
        
        const [staticTarget, setStaticTarget] = useState(120);
        const [rampStartBPM, setRampStartBPM] = useState(100);
        const [rampEndBPM, setRampEndBPM] = useState(160);
        const [rampDurationMins, setRampDurationMins] = useState(4);
        const [rampPeakMins, setRampPeakMins] = useState(30);
        
        const [hiitActiveBPM, setHiitActiveBPM] = useState(160);
        const [hiitRestBPM, setHiitRestBPM] = useState(90);
        const [hiitActiveSec, setHiitActiveSec] = useState(45);
        const [hiitRestSec, setHiitRestSec] = useState(15);
        const [hiitRounds, setHiitRounds] = useState(10);
        
        const [progressionModel, setProgressionModel] = useState('smooth');
        const [easeFunc, setEaseFunc] = useState('cubic'); 
        const [easeMode, setEaseMode] = useState('inOut');
        const [transSpeed, setTransSpeed] = useState(5); 
        const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);

        const [isRecoveryEnabled, setIsRecoveryEnabled] = useState(false);
        const [showRecoveryInfo, setShowRecoveryInfo] = useState(false);
        const [recoveryIntervalMins, setRecoveryIntervalMins] = useState(4);
        const [recoveryDurationSec, setRecoveryDurationSec] = useState(60);
        const [recoveryDipBPM, setRecoveryDipBPM] = useState(20);
        const [inRecoveryPhase, setInRecoveryPhase] = useState(false);
        
        const [history, setHistory] = useState([]);
        const [elapsedSeconds, setElapsedSeconds] = useState(0);
        const startTimeRef = useRef(0);
        const animationFrameRef = useRef(null);
        const stateRef = useRef({ currentBPM: 120, targetBPM: 120, mode: 'static' });

        useEffect(() => { stateRef.current.mode = mode; }, [mode]);

        const getEasedProgress = (t, func, mode) => {
            switch (func) {
                case 'sine': return mode === 'in' ? 1 - Math.cos((t * Math.PI) / 2) : mode === 'out' ? Math.sin((t * Math.PI) / 2) : -(Math.cos(Math.PI * t) - 1) / 2;
                case 'cubic': return mode === 'in' ? t*t*t : mode === 'out' ? 1 - Math.pow(1-t, 3) : t < .5 ? 4*t*t*t : 1 - Math.pow(-2*t+2, 3)/2;
                case 'expo': return mode === 'in' ? (t===0?0:Math.pow(2, 10*t-10)) : mode === 'out' ? (t===1?1:1-Math.pow(2, -10*t)) : (t===0?0:t===1?1:t<.5?Math.pow(2, 20*t-10)/2:(2-Math.pow(2, -20*t+10))/2);
                default: return t;
            }
        };

        useEffect(() => {
            if (!isPlaying) { if(animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current); return; }
            const updateLoop = () => {
                const now = Date.now();
                const elapsedSec = (now - startTimeRef.current) / 1000;
                setElapsedSeconds(Math.floor(elapsedSec));
                
                let baseTarget = stateRef.current.targetBPM;

                if (stateRef.current.mode === 'ramp') {
                    const rampSec = rampDurationMins * 60;
                    if (elapsedSec < rampSec) {
                        let progress = elapsedSec / rampSec;
                        if (progressionModel === 'smooth') progress = getEasedProgress(progress, easeFunc, easeMode);
                        baseTarget = rampStartBPM + (rampEndBPM - rampStartBPM) * progress;
                    } else baseTarget = rampEndBPM;
                } else if (stateRef.current.mode === 'hiit') {
                    const cycleTime = hiitActiveSec + hiitRestSec;
                    baseTarget = ((elapsedSec % cycleTime) < hiitActiveSec) ? hiitActiveBPM : hiitRestBPM;
                }

                let finalTarget = baseTarget;
                if (isRecoveryEnabled && stateRef.current.mode !== 'hiit') {
                    const totalCycleSec = (recoveryIntervalMins * 60) + recoveryDurationSec;
                    const cyclePos = elapsedSec % totalCycleSec;
                    if (cyclePos >= (recoveryIntervalMins * 60)) {
                        setInRecoveryPhase(true);
                        const recProgress = (cyclePos - (recoveryIntervalMins * 60)) / recoveryDurationSec;
                        let dipFactor = recProgress < 0.25 ? (recProgress / 0.25) : 1 - ((recProgress - 0.25) / 0.75);
                        finalTarget = baseTarget - (recoveryDipBPM * dipFactor);
                    } else setInRecoveryPhase(false);
                }

                const diff = finalTarget - stateRef.current.currentBPM;
                if (Math.abs(diff) > 0.1) {
                    let step = progressionModel === 'smooth' ? diff * (0.1 / transSpeed) : Math.sign(diff) * Math.min(Math.abs(diff), (30 / transSpeed) / 60);
                    stateRef.current.currentBPM += step;
                } else stateRef.current.currentBPM = finalTarget;

                const roundedBPM = Math.round(stateRef.current.currentBPM);
                if (roundedBPM !== currentBPM) setCurrentBPM(roundedBPM);
                if (Math.floor(elapsedSec) > (historyRef.current.lastLogged || -1)) {
                    historyRef.current.lastLogged = Math.floor(elapsedSec);
                    setHistory(prev => { const newData = [...prev, { bpm: roundedBPM }]; if (newData.length > 100) newData.shift(); return newData; });
                }
                animationFrameRef.current = requestAnimationFrame(updateLoop);
            };
            animationFrameRef.current = requestAnimationFrame(updateLoop);
            return () => cancelAnimationFrame(animationFrameRef.current);
        }, [isPlaying, rampDurationMins, rampStartBPM, rampEndBPM, hiitActiveBPM, hiitRestBPM, hiitActiveSec, hiitRestSec, transSpeed, progressionModel, easeFunc, easeMode, isRecoveryEnabled, recoveryIntervalMins, recoveryDurationSec, recoveryDipBPM]);

        const scheduler = () => {
            while (engine.current.getCurrentTime() + engine.current.scheduleAheadTime > engine.current.nextNoteTimeRef.current) {
                scheduleNote(engine.current.nextNoteTimeRef.current);
                nextNote();
            }
            engine.current.timerIDRef.current = setTimeout(scheduler, engine.current.lookahead);
        };
        const scheduleNote = (time) => {
            const beat = engine.current.currentBeatRef.current;
            engine.current.playClick(time, beat);
            const drawTime = (time - engine.current.getCurrentTime()) * 1000;
            setTimeout(() => setBeatIndex(beat), Math.max(0, drawTime));
        };
        const nextNote = () => {
            const secondsPerBeat = 60.0 / (Math.max(1, stateRef.current.currentBPM));
            engine.current.nextNoteTimeRef.current += secondsPerBeat;
            engine.current.currentBeatRef.current = (engine.current.currentBeatRef.current + 1) % 2;
        };

        const historyRef = useRef({ lastLogged: -1 });
        const audioCtxInit = useRef(false);

        const togglePlay = () => {
            if (!audioCtxInit.current) { engine.current.init(); audioCtxInit.current = true; }
            engine.current.resume();
            if (isPlaying) { setIsPlaying(false); clearTimeout(engine.current.timerIDRef.current); }
            else {
                setIsPlaying(true); setHistory([]); setElapsedSeconds(0); historyRef.current.lastLogged = -1; startTimeRef.current = Date.now();
                if (mode === 'static') { stateRef.current.targetBPM = staticTarget; stateRef.current.currentBPM = staticTarget; }
                else if (mode === 'ramp') stateRef.current.currentBPM = rampStartBPM;
                engine.current.currentBeatRef.current = 0; engine.current.nextNoteTimeRef.current = engine.current.getCurrentTime() + 0.1; scheduler();
            }
        };

        const adjustBPM = (delta) => {
            if (mode === 'ramp') { setRampStartBPM(p => Math.max(40, p + delta)); setRampEndBPM(p => Math.max(40, p + delta)); stateRef.current.currentBPM += delta; }
            else if (mode === 'hiit') { setHiitActiveBPM(p => p + delta); setHiitRestBPM(p => p + delta); stateRef.current.currentBPM += delta; }
            else { stateRef.current.targetBPM += delta; setStaticTarget(stateRef.current.targetBPM); }
        };

        const SleekInput = ({ label, value, setter, min, max, unit }) => (
            <div className="flex flex-col items-center bg-oled-dark/50 p-3 rounded-2xl border border-white/5 flex-1">
                <div className="text-[9px] text-oled-muted font-bold uppercase mb-2 tracking-tighter">{label}</div>
                <div className="flex items-center gap-2">
                    <button onClick={() => setter(Math.max(min, value-1))} className="w-7 h-7 flex items-center justify-center rounded-full bg-oled-card text-oled-teal hover:bg-white/10 active:scale-90 transition-all font-bold text-lg select-none">-</button>
                    <span className="text-sm font-bold text-white min-w-[2.2rem] text-center select-none">{value}{unit && <span className="text-[9px] ml-0.5">{unit}</span>}</span>
                    <button onClick={() => setter(Math.min(max, value+1))} className="w-7 h-7 flex items-center justify-center rounded-full bg-oled-card text-oled-teal hover:bg-white/10 active:scale-90 transition-all font-bold text-lg select-none">+</button>
                </div>
            </div>
        );

        const formatTime = (s) => `${Math.floor(s / 60).toString().padStart(2, '0')}m${(s % 60).toString().padStart(2, '0')}s`;
        const getWorkoutTotal = () => mode === 'ramp' ? (rampDurationMins + rampPeakMins) * 60 : mode === 'hiit' ? (hiitActiveSec + hiitRestSec) * hiitRounds : 0;

        const CurveVisualizer = () => {
            const points = []; const steps = 50;
            for(let i=0; i<=steps; i++) { const x = i/steps; const y = progressionModel==='linear'?x:getEasedProgress(x, easeFunc, easeMode); points.push(`${x * 100},${(1 - y) * 50}`); }
            return (<div className="w-full h-16 bg-oled-dark/50 rounded-xl border border-white/5 relative overflow-hidden mt-3"><svg viewBox="0 0 100 50" preserveAspectRatio="none" className="w-full h-full p-2"><line x1="0" y1="50" x2="100" y2="0" stroke="#333" strokeWidth="0.5" strokeDasharray="2" /><polyline points={points.join(' ')} fill="none" stroke="#00F0FF" strokeWidth="2" strokeLinecap="round" /></svg></div>);
        };

        return (
            <div className="h-screen w-full flex flex-col bg-oled-black overflow-hidden relative">
                <div className={`light-overlay ${isPlaying && beatIndex === 0 ? 'light-left' : ''} ${isPlaying && beatIndex === 1 ? 'light-right' : ''}`}></div>
                
                <div className="fixed top-0 left-0 right-0 z-40 w-full max-w-md mx-auto pt-4 px-6 flex justify-between items-end">
                    <h1 className="text-xl font-bold tracking-tighter italic text-oled-teal">FITPULSE<span className="text-white">PRO</span></h1>
                    <div className="text-[10px] font-mono text-oled-muted border border-oled-card px-2 py-0.5 rounded-full">V9.4 Restored</div>
                </div>

                {/* Reduced Height Section */}
                <div className={`fixed top-0 left-0 right-0 z-20 bg-oled-black border-b border-white/5 transition-all duration-500 ease-in-out ${isPlaying ? 'h-[30vh] border-b-0' : 'h-[45vh] min-h-[350px]'}`}></div>

                <div className={`fixed top-0 left-0 right-0 z-40 flex flex-col items-center justify-center transition-all duration-500 ease-in-out bg-transparent ${isPlaying ? 'h-[30vh] pt-16' : 'h-[45vh] min-h-[350px] pt-10'}`}>
                    <div className="flex flex-col items-center transition-transform duration-500">
                        <div className={`text-9xl font-bold tracking-tighter tabular-nums leading-none select-none drop-shadow-2xl transition-colors ${inRecoveryPhase ? 'text-oled-teal' : 'text-white'}`}>{currentBPM}</div>
                        <div className="text-oled-teal font-bold tracking-widest text-sm uppercase mt-4 tracking-tighter">{inRecoveryPhase ? 'Active Recovery Glide' : 'Steps Per Minute'}</div>
                    </div>
                    {/* Neon Play Button */}
                    <div className={`mt-6 transition-all duration-300 ${isPlaying ? 'opacity-0 scale-0 h-0 m-0' : 'opacity-100 scale-100 h-20'}`}>
                        <button onClick={togglePlay} className="flex items-center justify-center hover:scale-110 active:scale-95 transition-transform"><Icons.NeonPlay /></button>
                    </div>
                </div>

                <div className={`flex-1 w-full overflow-y-auto no-scrollbar z-10 relative transition-all duration-500 ${isPlaying ? 'opacity-0 translate-y-20' : 'opacity-100 translate-y-0'}`}>
                    <div className="w-full h-[45vh] min-h-[350px] pointer-events-none"></div>
                    <div className="w-full max-w-md mx-auto px-4 pb-40 pt-6 flex flex-col gap-3">
                        <div className="bg-oled-card/50 p-1 rounded-2xl flex backdrop-blur-md mb-2">
                            {[{id:'static',l:'Static'},{id:'ramp',l:'Ramp'},{id:'hiit',l:'HIIT'}].map(m=>(<button key={m.id} onClick={()=>setMode(m.id)} className={`flex-1 py-3 text-xs font-bold uppercase tracking-widest rounded-xl transition-all cursor-pointer ${mode===m.id?'bg-oled-card text-oled-teal shadow-lg':'text-oled-muted hover:text-white'}`}>{m.l}</button>))}
                        </div>

                        <div className="bg-oled-card rounded-3xl p-5 border border-oled-dark">
                            {mode === 'static' && (
                                <div className="flex flex-col gap-1 mb-2">
                                    <div className="text-xs text-oled-muted uppercase font-bold tracking-wider mb-2">Target Cadence</div>
                                    <div className="flex items-center gap-4 bg-oled-dark p-1 rounded-xl border border-white/5">
                                        <button className="p-3 bg-oled-card rounded-lg hover:bg-gray-800 active:scale-95 transition-all text-oled-teal" onClick={() => adjustBPM(-5)}><Icons.Minus /></button>
                                        <div className="flex-1 text-center select-none"><span className="text-2xl font-bold text-white">{staticTarget}</span><span className="text-xs text-oled-muted ml-1">SPM</span></div>
                                        <button className="p-3 bg-oled-card rounded-lg hover:bg-gray-800 active:scale-95 transition-all text-oled-teal" onClick={() => adjustBPM(5)}><Icons.Plus /></button>
                                    </div>
                                </div>
                            )}
                            
                            {mode === 'ramp' && (
                                <div className="flex flex-col gap-4">
                                    <div className="grid grid-cols-2 gap-3"><SleekInput label="Start BPM" value={rampStartBPM} setter={setRampStartBPM} min={40} max={200} /><SleekInput label="Peak BPM" value={rampEndBPM} setter={setRampEndBPM} min={60} max={220} /></div>
                                    <div className="space-y-4 pt-2 border-t border-white/5">
                                        <div><div className="flex justify-between text-xs text-oled-muted font-bold uppercase mb-2">Ramp: <span className="text-white">{rampDurationMins} min</span></div><input type="range" min="1" max="20" value={rampDurationMins} onChange={(e) => setRampDurationMins(Number(e.target.value))} /></div>
                                        <div><div className="flex justify-between text-xs text-oled-muted font-bold uppercase mb-2">Peak: <span className="text-white">{rampPeakMins} min</span></div><input type="range" min="1" max="60" value={rampPeakMins} onChange={(e) => setRampPeakMins(Number(e.target.value))} /></div>
                                    </div>
                                </div>
                            )}

                            {mode === 'hiit' && (
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-3"><SleekInput label="Sprint BPM" value={hiitActiveBPM} setter={setHiitActiveBPM} min={60} max={240} /><SleekInput label="Rest BPM" value={hiitRestBPM} setter={setHiitRestBPM} min={40} max={180} /></div>
                                    <div className="grid grid-cols-2 gap-3"><SleekInput label="Sprint Time" value={hiitActiveSec} setter={setHiitActiveSec} min={5} max={120} unit="s" /><SleekInput label="Rest Time" value={hiitRestSec} setter={setHiitRestSec} min={5} max={120} unit="s" /></div>
                                    <div className="bg-oled-dark/50 p-3 rounded-2xl border border-white/5"><div className="flex justify-between mb-2"><div className="text-[10px] text-oled-muted font-bold uppercase">Rounds</div><div className="text-xs font-bold text-white">{hiitRounds}</div></div><input type="range" min="1" max="50" value={hiitRounds} onChange={(e) => setHiitRounds(Number(e.target.value))} /></div>
                                </div>
                            )}

                            {(mode === 'static' || mode === 'ramp') && (
                                <div className="mt-4 pt-4 border-t border-white/5">
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center gap-2">
                                            <span className="text-xs font-bold uppercase tracking-widest text-oled-muted">Recovery Intervals</span>
                                            <button onClick={() => setShowRecoveryInfo(!showRecoveryInfo)} className="text-oled-teal hover:text-white transition-colors"><Icons.Info /></button>
                                        </div>
                                        <button onClick={() => setIsRecoveryEnabled(!isRecoveryEnabled)} className={`w-12 h-6 rounded-full transition-all relative ${isRecoveryEnabled ? 'bg-oled-teal' : 'bg-oled-card border border-white/10'}`}>
                                            <div className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-all ${isRecoveryEnabled ? 'left-7' : 'left-1'}`}></div>
                                        </button>
                                    </div>
                                    <div className={`transition-all duration-300 overflow-hidden ${isRecoveryEnabled ? 'max-h-64 opacity-100' : 'max-h-0 opacity-0'}`}>
                                        <div className="flex flex-col gap-2">
                                            <div className="flex gap-2">
                                                <SleekInput label="Work Interval" value={recoveryIntervalMins} setter={setRecoveryIntervalMins} min={1} max={15} unit="m" />
                                                <SleekInput label="Glide Time" value={recoveryDurationSec} setter={setRecoveryDurationSec} min={10} max={120} unit="s" />
                                            </div>
                                            <div className="bg-oled-dark/50 p-3 rounded-2xl border border-white/5">
                                                <div className="flex justify-between mb-1.5"><span className="text-[9px] text-oled-muted font-bold uppercase">Metabolic Dip</span><span className="text-[10px] font-bold text-white">{recoveryDipBPM} BPM</span></div>
                                                <input type="range" min="5" max="50" value={recoveryDipBPM} onChange={(e)=>setRecoveryDipBPM(Number(e.target.value))} />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="mt-1 bg-oled-card rounded-3xl border border-oled-dark overflow-hidden mb-8">
                            <button onClick={() => setIsAdvancedOpen(!isAdvancedOpen)} className="w-full flex justify-between items-center p-5 text-left hover:bg-white/5 transition-colors cursor-pointer"><span className="text-sm text-oled-muted font-bold uppercase tracking-widest">Advanced Settings</span><div className={`text-oled-muted transition-transform duration-300 ${isAdvancedOpen?'rotate-180':'rotate-0'}`}><Icons.ChevronDown /></div></button>
                            <div className={`transition-all duration-300 ease-in-out px-5 ${isAdvancedOpen ? 'max-h-[800px] pb-5 opacity-100' : 'max-h-0 pb-0 opacity-0'}`}>
                                <div className="space-y-4">
                                    <div><label className="text-xs text-oled-muted uppercase font-bold tracking-wider">Adjustment Speed</label><div className="bg-oled-dark/50 p-1 rounded-xl flex backdrop-blur-md mt-1">{[{l:'Slow (10s)', v:10},{l:'Med (5s)', v:5},{l:'Fast (2s)', v:2}].map(s=>(<button key={s.v} onClick={()=>setTransSpeed(s.v)} className={`flex-1 py-2 text-[10px] font-bold uppercase rounded-lg transition-all ${transSpeed===s.v?'bg-oled-card text-oled-teal shadow-sm':'text-oled-muted hover:text-white'}`}>{s.l}</button>))}</div></div>
                                    <div>
                                        <label className="text-xs text-oled-muted uppercase font-bold tracking-wider">Progression Logic</label>
                                        <div className="bg-oled-dark/50 p-1 rounded-xl flex backdrop-blur-md mt-1 mb-2">
                                            {['linear', 'smooth'].map(m => (<button key={m} onClick={() => setProgressionModel(m)} className={`flex-1 py-2 text-xs font-bold uppercase tracking-widest rounded-lg transition-all ${progressionModel === m ? 'bg-oled-card text-oled-teal shadow-sm' : 'text-oled-muted hover:text-white'}`}>{m}</button>))}
                                        </div>
                                        {progressionModel === 'smooth' && (
                                            <div className="animate-fade-in block mt-4 border-t border-white/5 pt-4">
                                                <div className="flex gap-2 mb-4">
                                                    <div className="flex-1">
                                                        <label className="text-[10px] text-oled-muted uppercase font-bold mb-1 block">Function</label>
                                                        <div className="bg-oled-dark p-1 rounded-lg flex">
                                                            {['sine', 'cubic'].map(f => (<button key={f} onClick={()=>setEaseFunc(f)} className={`flex-1 py-1 text-[10px] font-bold uppercase rounded ${easeFunc===f?'bg-oled-card text-white':'text-oled-muted'}`}>{f}</button>))}
                                                        </div>
                                                    </div>
                                                    <div className="flex-1">
                                                        <label className="text-[10px] text-oled-muted uppercase font-bold mb-1 block">Mode</label>
                                                        <div className="bg-oled-dark p-1 rounded-lg flex">
                                                            {['in', 'out', 'inOut'].map(m => (<button key={m} onClick={()=>setEaseMode(m)} className={`flex-1 py-1 text-[10px] font-bold uppercase rounded ${easeMode===m?'bg-oled-card text-white':'text-oled-muted'}`}>{m}</button>))}
                                                        </div>
                                                    </div>
                                                </div>
                                                <CurveVisualizer />
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div className={`fixed bottom-0 w-full z-0 transition-all duration-700 ${isPlaying ? 'h-[50%] opacity-60' : 'h-[30%] opacity-0'}`}>
                     <ResponsiveContainer width="100%" height="100%">
                        <AreaChart data={history}><defs><linearGradient id="colorBpm" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#00F0FF" stopOpacity={0.6}/><stop offset="95%" stopColor="#00F0FF" stopOpacity={0}/></linearGradient></defs><Area type="monotone" dataKey="bpm" stroke="#00F0FF" strokeWidth={3} fill="url(#colorBpm)" isAnimationActive={false} /></AreaChart>
                    </ResponsiveContainer>
                </div>

                <div className={`fixed bottom-0 w-full z-20 bg-oled-black border-t border-white/10 h-24 transition-transform duration-500 ${isPlaying ? 'translate-y-0' : 'translate-y-full'}`}></div>
                <div className={`fixed bottom-0 w-full z-40 transition-transform duration-500 ${isPlaying ? 'translate-y-0' : 'translate-y-full'}`}>
                    <div className="w-full max-w-md mx-auto px-4 mb-12 flex items-center justify-center gap-8">
                        <button onClick={() => adjustBPM(-5)} className="flex items-center justify-center rounded-full bg-oled-card border border-oled-dark text-oled-teal active:scale-95 transition-all w-16 h-16 pointer-events-auto"><Icons.Minus /></button>
                        <button onClick={togglePlay} className="rounded-full flex items-center justify-center transition-all shadow-2xl w-24 h-24 bg-oled-dark text-oled-accent border-2 border-oled-card hover:border-oled-accent pointer-events-auto"><Icons.Pause /></button>
                        <button onClick={() => adjustBPM(5)} className="flex items-center justify-center rounded-full bg-oled-card border border-oled-dark text-oled-teal active:scale-95 transition-all w-16 h-16 pointer-events-auto"><Icons.Plus /></button>
                    </div>
                    <div className="w-full p-4 absolute bottom-0 left-0 right-0">
                        <div className="max-w-md mx-auto flex justify-between items-center text-xs font-sans">
                            <div className="flex flex-col"><span className="text-oled-teal font-bold uppercase tracking-wider">{mode} RUNNING</span><span className="text-oled-muted font-medium">{formatTime(elapsedSeconds)} | {mode === 'static' ? '--m--s' : formatTime(getWorkoutTotal())}</span></div>
                            <div className="flex items-center gap-2 text-oled-teal animate-pulse font-bold"><div className="w-2 h-2 rounded-full bg-oled-teal"></div> LIVE</div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FitPulseApp />);
</script>

</body>
</html>